<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒ—ãƒª</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f8f8ff;
    margin: 20px;
  }
  h1 {
    text-align: center;
    color: #333;
    font-size: 1.6em;
    margin-bottom: 25px;
  }

  .main {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 30px;
    flex-wrap: wrap;
  }

  .container, .side {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    width: 400px;
    max-width: 90%;
    box-sizing: border-box;
  }

  label {
    display: block;
    margin-top: 12px;
    font-size: 1em;
  }
  input {
    width: 100%;
    padding: 10px;
    font-size: 1em;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-top: 4px;
  }
  button {
    width: 100%;
    padding: 12px;
    font-size: 1em;
    font-weight: bold;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.2s;
  }

  button:hover {
    opacity: 0.9;
  }

  .btn-blue { background: #4a90e2; color: white; }
  .btn-green { background: #28a745; color: white; }
  .btn-red { background: #ff6b6b; color: white; margin-top: 10px; }

  /* ğŸŒŸ ä¸¸å‹ ç¶™ç¶šãƒœã‚¿ãƒ³ï¼ˆæŠ¼ã—ã‚„ã™ãã€æ‹¡å¤§ã—ãªã„ï¼‰ */
  .btn-circle {
    background: #a44ae2;
    color: #fff;
    width: 90px;
    height: 90px;
    border-radius: 50%;
    font-size: 1.2em;
    font-weight: bold;
    line-height: 1.1;
    margin: 15px auto;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s, transform 0.1s;
    box-shadow: 0 4px 10px rgba(164,74,226,0.4);
  }
  .btn-circle:hover {
    background: #8b38c7;
  }
  .btn-circle:active {
    transform: scale(0.95);
  }

  .count {
    font-size: 1.8em;
    font-weight: bold;
    color: #6c2db7;
    margin-top: 10px;
  }

  .result {
    margin-top: 20px;
    background: #f0f0f0;
    padding: 15px;
    border-radius: 10px;
  }

  pre {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #ddd;
    overflow-x: auto;
  }

  .grape {
    margin-top: 25px;
    padding-top: 10px;
    border-top: 1px solid #ccc;
  }

  /* ã‚¹ãƒãƒ›å¯¾å¿œ */
  @media (max-width: 768px) {
    body {
      margin: 10px;
    }
    h1 {
      font-size: 1.4em;
      margin-bottom: 15px;
    }
    .main {
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    .container, .side {
      width: 95%;
      padding: 15px;
    }
    button {
      font-size: 1.1em;
      padding: 10px;
    }
    .btn-circle {
      width: 80px;
      height: 80px;
      font-size: 1.1em;
    }
    input {
      font-size: 1em;
      padding: 9px;
    }
    .count {
      font-size: 1.6em;
    }
  }
</style>
</head>
<body>
  <h1>ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒ—ãƒª</h1>

  <div class="main">
    <!-- å·¦ï¼šç´¯è¨ˆè¨ˆç®—ã‚¨ãƒªã‚¢ -->
    <div class="container">
      <label>ä»Šå›ã® G:</label>
      <input type="number" id="g" placeholder="ä¾‹: 1200">
      <label>ä»Šå›ã® BIG:</label>
      <input type="number" id="big" placeholder="ä¾‹: 6">
      <label>ä»Šå›ã® REG:</label>
      <input type="number" id="reg" placeholder="ä¾‹: 4">

      <button class="btn-blue" onclick="addData()">è¿½åŠ ã—ã¦è¨ˆç®—</button>
      <div class="result" id="output"></div>
      <button class="btn-red" onclick="resetData()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>

    <!-- å³ï¼šç¶™ç¶šãƒœã‚¿ãƒ³ï¼‹å°ç‰©ç¢ºç‡ï¼‹ã¶ã©ã†é€†ç®— -->
    <div class="side">
      <h3>ç¶™ç¶šã‚«ã‚¦ãƒ³ã‚¿ãƒ¼</h3>
      <button class="btn-circle" onclick="addContinue()">ç¶™ç¶šï¼‹</button>
      <div class="count" id="continueCount">0</div>
      <button class="btn-red" onclick="resetContinue()">ãƒªã‚»ãƒƒãƒˆ</button>

      <!-- å°ç‰©ç¢ºç‡ï¼ˆã¶ã©ã†ã‚«ã‚¦ãƒ³ãƒˆï¼‰ -->
      <div class="grape">
        <h3>å°ç‰©ç¢ºç‡</h3>
        <label>Gæ•°:</label>
        <input type="number" id="grapeG" placeholder="ä¾‹: 1000">
        <label>å°ç‰©:</label>
        <input type="number" id="grapeCount" placeholder="ä¾‹: 10">
        <button class="btn-green" onclick="addGrape()">è¿½åŠ ã—ã¦æ›´æ–°</button>
        <div class="count" id="grapeRate">--</div>
        <button class="btn-red" onclick="resetGrape()">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <!-- â˜… ã¶ã©ã†é€†ç®—ãƒ„ãƒ¼ãƒ«ï¼ˆå·®æšãƒ»Gæ•°ãƒ»å‡ºç‡ãƒ»BIGãƒ»REG ã‹ã‚‰è¨ˆç®—ï¼‰ -->
      <div class="grape">
        <h3>ã¶ã©ã†é€†ç®—ãƒ„ãƒ¼ãƒ«</h3>
        <label>å·®æšï¼ˆæšï¼‰â€»ç©ºæ¬„ãªã‚‰å‡ºç‡ã‹ã‚‰è¨ˆç®—</label>
        <input type="number" id="bdDiff" placeholder="ä¾‹: -298">
        <label>ç· G æ•°</label>
        <input type="number" id="bdG" placeholder="ä¾‹: 6643">
        <label>å‡ºç‡ï¼ˆ%ï¼‰â€»ä»»æ„</label>
        <input type="number" id="bdRate" placeholder="ä¾‹: 98.5" step="0.1">
        <label>BIG å›æ•°</label>
        <input type="number" id="bdBig" placeholder="ä¾‹: 26">
        <label>REG å›æ•°</label>
        <input type="number" id="bdReg" placeholder="ä¾‹: 15">

        <button class="btn-green" onclick="calcBudo()">ã¶ã©ã†ã‚’é€†ç®—</button>
        <div class="result" id="bdResult"></div>
      </div>
    </div>
  </div>

<script>
// ===== G/BIG/REG è¨ˆç®—éƒ¨åˆ† =====
function loadData() {
  return JSON.parse(localStorage.getItem("records")) || [];
}
function saveData(data) {
  localStorage.setItem("records", JSON.stringify(data));
}
function addData() {
  const g = parseInt(document.getElementById("g").value) || 0;
  const big = parseInt(document.getElementById("big").value) || 0;
  const reg = parseInt(document.getElementById("reg").value) || 0;
  const data = loadData();
  data.push({ g, big, reg });
  saveData(data);

  let total_g = 0, total_BIG = 0, total_REG = 0;
  data.forEach(d => {
    total_g += d.g;
    total_BIG += d.big;
    total_REG += d.reg;
  });

  const g_per_BIG = total_BIG > 0 ? (total_g / total_BIG).toFixed(2) : "---";
  const g_per_REG = total_REG > 0 ? (total_g / total_REG).toFixed(2) : "---";

  document.getElementById("output").innerHTML = `
    <h3>=== ç´¯è¨ˆçµæœ ===</h3>
    <pre>
ç·Gæ•°: ${total_g}
ç·BIG: ${total_BIG}
ç·REG: ${total_REG}
    </pre>
    <h3>=== è¨ˆç®—çµæœ ===</h3>
    <pre>
G / BIG = ${g_per_BIG}
G / REG = ${g_per_REG}
    </pre>
  `;

  document.getElementById("g").value = "";
  document.getElementById("big").value = "";
  document.getElementById("reg").value = "";
}
function resetData() {
  if (confirm("ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
    localStorage.removeItem("records");
    document.getElementById("output").innerHTML = "";
  }
}

// ===== ç¶™ç¶šã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ =====
let cont = parseInt(localStorage.getItem("continueCount")) || 0;
document.getElementById("continueCount").textContent = cont;
function addContinue() {
  cont++;
  localStorage.setItem("continueCount", cont);
  document.getElementById("continueCount").textContent = cont;
}
function resetContinue() {
  if (confirm("ç¶™ç¶šã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
    cont = 0;
    localStorage.setItem("continueCount", cont);
    document.getElementById("continueCount").textContent = cont;
  }
}

// ===== ã¶ã©ã†ç¢ºç‡ï¼ˆç´¯è¨ˆã‚«ã‚¦ãƒ³ãƒˆï¼‰ =====
let grapeData = JSON.parse(localStorage.getItem("grapeRecords")) || [];

function addGrape() {
  const g = parseInt(document.getElementById("grapeG").value) || 0;
  const count = parseInt(document.getElementById("grapeCount").value) || 0;

  grapeData.push({ g, count });
  localStorage.setItem("grapeRecords", JSON.stringify(grapeData));

  updateGrapeDisplay();

  document.getElementById("grapeG").value = "";
  document.getElementById("grapeCount").value = "";
}

function updateGrapeDisplay() {
  let totalG = 0, totalCount = 0;
  grapeData.forEach(d => {
    totalG += d.g;
    totalCount += d.count;
  });

  let rate = (totalCount > 0) ? (totalG / totalCount).toFixed(2) : "---";
  document.getElementById("grapeRate").textContent = rate;
}

function resetGrape() {
  if (confirm("ã¶ã©ã†ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
    grapeData = [];
    localStorage.removeItem("grapeRecords");
    updateGrapeDisplay();
  }
}

updateGrapeDisplay();

// ===== ã¶ã©ã†é€†ç®—ï¼ˆå·®æšãƒ»Gæ•°ãƒ»å‡ºç‡ãƒ»BIGãƒ»REGï¼‰ =====

// å®šæ•°ï¼ˆ6å·æ©Ÿ Sã‚¢ã‚¤ãƒ æƒ³å®šï¼‰
const COIN_IN_PER_GAME = 3;    // 1Gã‚ãŸã‚Š 3 æšæŠ•å…¥
const BIG_PAYOUT        = 252; // BIG å¹³å‡æšæ•°
const REG_PAYOUT        = 96;  // REG å¹³å‡æšæ•°

// å°å½¹ï¼ˆé©å½“æ‰“ã¡æ™‚ã®ç†è«–å€¤ï¼‰
const REPLAY_PROB    = 1 / 7.298;
const REPLAY_PAYOUT  = 3;

const CHERRY_PROB    = 1 / 53.43;
const CHERRY_PAYOUT  = 2;

const BELL_PROB      = 1 / 4915.20;
const BELL_PAYOUT    = 14;

const PIERROT_PROB   = 1 / 10865.18;
const PIERROT_PAYOUT = 10;

const GRAPE_PAYOUT   = 8;  // ã¶ã©ã† 8 æšå½¹

function calcBudo() {
  const gEl       = document.getElementById("bdG");
  const diffEl    = document.getElementById("bdDiff");
  const rateEl    = document.getElementById("bdRate");
  const bigEl     = document.getElementById("bdBig");
  const regEl     = document.getElementById("bdReg");
  const resultEl  = document.getElementById("bdResult");

  const spins = Number(gEl.value);
  const bb    = Number(bigEl.value);
  const rb    = Number(regEl.value);

  if (!Number.isFinite(spins) || spins <= 0 ||
      !Number.isFinite(bb)    || bb < 0     ||
      !Number.isFinite(rb)    || rb < 0) {
    resultEl.textContent = "ç·Gæ•°ãƒ»BIGãƒ»REG ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
    return;
  }

  const totalIn = spins * COIN_IN_PER_GAME;

  // å·®æš or å‡ºç‡
  const diffStr = diffEl.value.trim();
  const rateStr = rateEl.value.trim();

  let diff;
  if (diffStr !== "") {
    diff = Number(diffStr);
    if (!Number.isFinite(diff)) {
      resultEl.textContent = "å·®æšã¯æ•°å€¤ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
      return;
    }
  } else if (rateStr !== "") {
    const rate = Number(rateStr);
    if (!Number.isFinite(rate)) {
      resultEl.textContent = "å‡ºç‡ã¯æ•°å€¤ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
      return;
    }
    // å·®æš = æŠ•å…¥æšæ•° Ã— (å‡ºç‡/100 - 1)
    diff = totalIn * (rate / 100 - 1);
  } else {
    resultEl.textContent = "å·®æšã‹å‡ºç‡ã®ã©ã¡ã‚‰ã‹ã¯å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
    return;
  }

  // ç·æ‰•ã„å‡ºã—æšæ•°
  const totalOut = totalIn + diff;

  // ãƒœãƒ¼ãƒŠã‚¹æ‰•ã„å‡ºã—
  const bonusOut = bb * BIG_PAYOUT + rb * REG_PAYOUT;

  // å°å½¹ï¼ˆå…¨éƒ¨ï¼‰ã®æ‰•ã„å‡ºã—
  const smallOutTotal = totalOut - bonusOut;

  // ã¶ã©ã†ä»¥å¤–ã®å°å½¹æ‰•ã„å‡ºã—ï¼ˆç†è«–å€¤ï¼‰
  const otherSmallOut =
    spins * (
      REPLAY_PROB   * REPLAY_PAYOUT +
      CHERRY_PROB   * CHERRY_PAYOUT +
      BELL_PROB     * BELL_PAYOUT   +
      PIERROT_PROB  * PIERROT_PAYOUT
    );

  // ã¶ã©ã†æ‰•ã„å‡ºã—æšæ•°
  const grapeOut = smallOutTotal - otherSmallOut;

  if (grapeOut <= 0) {
    resultEl.textContent = "è¨ˆç®—ä¸Šã€ã¶ã©ã†æ‰•ã„å‡ºã—ãŒ 0 æšä»¥ä¸‹ã«ãªã‚Šã¾ã—ãŸã€‚å…¥åŠ›å€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
    return;
  }

  const grapeHits = grapeOut / GRAPE_PAYOUT;
  if (grapeHits <= 0) {
    resultEl.textContent = "è¨ˆç®—ä¸Šã€ã¶ã©ã†å›æ•°ãŒ 0 å›ä»¥ä¸‹ã«ãªã‚Šã¾ã—ãŸã€‚";
    return;
  }

  const grapeProb = spins / grapeHits;           // 1/â—¯ ã® â—¯
  const payout    = (totalOut / totalIn) * 100;  // å®Ÿè³ªå‡ºç‡ï¼ˆå‚è€ƒï¼‰

  resultEl.innerHTML =
    `æ¨å®šã¶ã©ã†å›æ•°ï¼š<strong>${grapeHits.toFixed(1)}</strong> å›<br>` +
    `æ¨å®šã¶ã©ã†ç¢ºç‡ï¼š<strong>1/${grapeProb.toFixed(2)}</strong>ï¼ˆç´„ ${grapeProb.toFixed(2)} åˆ†ã®1ï¼‰<br>` +
    `è¨ˆç®—ä¸Šã®å‡ºç‡ï¼š${payout.toFixed(2)}%`;
}
</script>
</body>
</html>
